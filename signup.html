<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup | The Mars Mysteries</title>
    <!-- Tailwind CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@^2.0/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-black text-gray-100">

    <!-- Setup Form Section -->
    <div class="container mx-auto my-10 px-4 max-w-md">
        <h1 class="text-3xl font-bold text-orange-600 text-center mb-6">Set Up Your Account</h1>
        <form id="setup-form" class="bg-gray-900 p-6 rounded-lg shadow-lg">
            <label class="block text-gray-100 mb-2">Display Name:</label>
            <input type="text" id="display-name" class="w-full p-2 mb-4 text-gray-800" required>

            <label class="block text-gray-100 mb-2">Bio:</label>
            <textarea id="bio" class="w-full p-2 mb-4 text-gray-800" required></textarea>

            <button type="submit" class="w-full bg-orange-600 text-white p-2 rounded">Save</button>
        </form>
    </div>

    <!-- Firebase Configuration and JavaScript -->
    <script type="module">
        // Import the Firebase SDKs needed
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB3tX7_f9HaGYnRY5oVSMyelZdeFVTZahA",
          authDomain: "techforgeguild.firebaseapp.com",
          projectId: "techforgeguild",
          storageBucket: "techforgeguild.firebasestorage.app",
          messagingSenderId: "361603237143",
          appId: "1:361603237143:web:ea57807170fd4ff0006352",
          measurementId: "G-PYWLKG8W2P"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Wait for the user to be authenticated
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("User is authenticated:", user.uid);
            } else {
                alert("You need to log in first.");
                window.location.href = "/login.html"; // Redirect to login if not logged in
            }
        });

        // Form submission handler
        document.getElementById("setup-form").addEventListener("submit", async (e) => {
            e.preventDefault();

            // Get input values
            const displayName = document.getElementById("display-name").value;
            const bio = document.getElementById("bio").value;

            try {
                const user = auth.currentUser;
                if (user) {
                    // Save data to Firestore under the user's UID
                    await setDoc(doc(db, "users", user.uid), {
                        displayName: displayName,
                        bio: bio
                    });
                    alert("Setup completed successfully!");
                    window.location.href = "/"; // Redirect to homepage after setup
                } else {
                    alert("You need to log in first.");
                    window.location.href = "/login.html"; // Redirect to login if not logged in
                }
            } catch (error) {
                console.error("Error saving data:", error);
                alert(`Error saving data: ${error.message}`);
            }
        });
    </script>
</body>
</html>